SELECT
    ad_id,
    ROUND(CASE
            WHEN
                COUNT(CASE WHEN action = 'Clicked' THEN action ELSE NULL END)+
                COUNT(CASE WHEN action = 'Viewed' THEN action ELSE NULL END) = 0 THEN 0
            ELSE
                COUNT(CASE WHEN action = 'Clicked' THEN action ELSE NULL END)/
                (COUNT(CASE WHEN action = 'Clicked' THEN action ELSE NULL END)+
                 COUNT(CASE WHEN action = 'Viewed' THEN action ELSE NULL END))*100
          END, 2) AS ctr
FROM Ads
GROUP BY ad_id
ORDER BY
    ctr DESC,
    ad_id;
